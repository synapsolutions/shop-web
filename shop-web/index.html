<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <meta name="mobile-web-app-capable" content="yes">

    <title>Shop Web</title>
    <script src="https://button.pay.synapsolutions.com/web/latest/sdk.js"></script>
    <script src="js/js-sha512.js"></script>
    <link rel="stylesheet" href="css/style.css">

    <script>
        function startPayment() {
            // Seteo de los campos de la transacción
            var transaction = setTransaction();

            // Seteo de los campos de autenticación de seguridad
            var authenticator = setAuthentication(transaction);

            // Manejo de los campos de respuesta
            var form = new Synap.Form({
                authentication: authenticator,
                transaction: transaction,
                environment: 'sbx',
                listeners: {
                    afterPay: function (response) {
                        // Agregue el código según la experiencia de su cliente
                        console.info({ ecommerceCapureResponse: response });
                    }
                }
            });
            form.render('#cart-container');
        }

        function setAuthentication(transaction) {
            apiKey = 'b062e7e7-5bb6-4e33-95e5-4e0bf55dc4b1',

            // Inicio
            // La firma se debe generar en el servidor del comercio utilizando la función criptográfica SHA-512
            // La firma permite verificar la integridad de la transacción
            signatureKey = 'frYsgA0jjswS!VShKl+coK_hwFLBi/j$',
            signatureBase =  apiKey + transaction.order.identifier + transaction.order.currency.code + transaction.order.amount + signatureKey
            signature = sha512(signatureBase);
            // Fin de firma, que debe generarse en el servidor del comercio

            var authenticationData = {
                // Sete de identificador con el APIKey del comercio
                identifier: apiKey,
                signature: signature,
            }
            return authenticationData;
        }

        function setTransaction() {
            // Genere el número de orden
            var generateNumberOrder = (new Date()).getTime() + "";

            // Seteo de los datos de transacción
            var transaction = {
                "order": {
                    "number": generateNumberOrder,
                    "amount": "1.00",
                    "country": {
                        "code": "PER"
                    },
                    "currency": {
                        "code": "PEN"
                    },
                    "products": [
                        {
                            "name": "Llavero"
                        }
                    ],
                    "customer": {
                        "name": "Javier",
                        "lastName": "Pérez",
                        "address": {
                            "country": "PER",
                            "levels": [
                                "LIMA",
                                "LIMA",
                                "SAN ISIDRO"
                            ],
                            "line1": "Av Carlos Ferreyros 180",
                            "zip": "051014"
                        },
                        "email": "javier.perez@synapsolutions.com",
                        "phone": "999555666",
                        "document": {
                            "type": "DNI",
                            "number": "44556677"
                        }
                    },
                    "shipping": {
                        "name": "Javier",
                        "lastName": "Pérez",
                        "address": {
                            "country": "PER",
                            "levels": [
                                "LIMA",
                                "LIMA",
                                "SAN ISIDRO"
                            ],
                            "line1": "Av Carlos Ferreyros 180",
                            "zip": "051014"
                        },
                        "email": "javier.perez@synapsolutions.com",
                        "phone": "999555666",
                        "document": {
                            "type": "DNI",
                            "number": "44556677"
                        }
                    },
                    "billing": {
                        "name": "Javier",
                        "lastName": "Pérez",
                        "address": {
                            "country": "PER",
                            "levels": [
                                "LIMA",
                                "LIMA",
                                "SAN ISIDRO"
                            ],
                            "line1": "Av Carlos Ferreyros 180",
                            "zip": "051014"
                        },
                        "email": "javier.perez@synapsolutions.com",
                        "phone": "999555666",
                        "document": {
                            "type": "DNI",
                            "number": "44556677"
                        }
                    }
                },
                "settings": {
                    "brands": ['VISA', 'MSCD', 'AMEX', 'DINC'],
                    "language": "es_PE",
                    "businessService": "WEB"
                }
            };
            return transaction;
        }
    </script>
</head>

<body>

    <div class="synap-center">
        <h2>Prueba nuestro widget</h2>
    </div>
    <div>
        <div class="synap-left">
            <div>
                <div class="synap-center">
                    <button class="synap-button" onclick="javascript:startPayment();">Probar pago por S/1.00</button>
                </div>
                <div class="blank-slate">
                    <div id="cart-container" class="synap-container">
                        <!-- Aquí se visualizará el widget de pago -->
                    </div>
                </div>
            </div>
        </div>

        <div class="synap-right">
            <div class="synap-center">
                <p>Presiona el botón "Probar pago por S/1.00” para abrir el widget de pago y realiza un pago de prueba.
                </p>
                <p>Puedes usar cualquiera de las siguientes tarjetas de prueba:</p>
                <br>
                <table>
                    <tr>
                        <th>Marca</th>
                        <th>Número de tarjeta</th>
                    </tr>
                    <tr>
                        <td> Visa </td>
                        <td> 4242 4242 4242 4242 </td>
                    </tr>
                    <tr>
                        <td> Mastercard </td>
                        <td> 5555 5555 5555 4444 </td>
                    </tr>
                    <tr>
                        <td> American Express </td>
                        <td> 3782 822463 10005 </td>
                    </tr>
                    <tr>
                        <td> Diners </td>
                        <td> 3056 9309 0259 04 </td>
                    </tr>
                </table>
            </div>
        </div>

    </div>
</body>


</html>